-- ==================   (day5 query to convert into CTE)    =================================================


-- 1

WITH DATE_DIFF_CTE (EMPLOYEE_ID , Date_Diff)
AS
	(
		SELECT  E.EMPLOYEE_ID , DATEDIFF(DAY , E.JOINING_DATE , I.INCENTIVE_DATE ) 'Date_Diff' FROM Employee AS E
		JOIN INCENTIVE AS I ON E.EMPLOYEE_ID = I.EMPLOYEE_REF_ID
	)
SELECT  EMPLOYEE_ID , Date_Diff FROM DATE_DIFF_CTE


-- 2

WITH INS_AMOUNT_3K (FIRST_NAME , INCENTIVE_AMOUNT)
AS
	(
	SELECT E.FIRST_NAME , I.INCENTIVE_AMOUNT FROM Employee AS E
	JOIN Incentive AS I ON E.EMPLOYEE_ID = I.EMPLOYEE_REF_ID WHERE I.INCENTIVE_AMOUNT > 3000
	)
SELECT FIRST_NAME , INCENTIVE_AMOUNT FROM INS_AMOUNT_3K

-- 3

WITH EMPLOYEE_ALL (FIRST_NAME , INCENTIVE_AMOUNT)
AS
	(
	SELECT E.FIRST_NAME , I.INCENTIVE_AMOUNT FROM Employee AS E
	LEFT JOIN Incentive AS I ON E.EMPLOYEE_ID = I.EMPLOYEE_REF_ID 
	)
SELECT FIRST_NAME, INCENTIVE_AMOUNT FROM EMPLOYEE_ALL

-- 4

WITH EMP_MANAGER (EMP_NAME , MAN_NAME)
AS
	(
	SELECT EMP.FIRST_NAME ,E.FIRST_NAME FROM Employee AS E
	JOIN  Employee AS EMP ON E.EMPLOYEE_ID = EMP.MANAGER_ID 
	)
SELECT EMP_NAME , MAN_NAME FROM EMP_MANAGER


-- 5 

WITH EMP_ALL_INC (FIRST_NAME , INCENTIVE_AMOUNT)
AS
	(
	SELECT E.FIRST_NAME , ISNULL(I.INCENTIVE_AMOUNT , 0) INCENTIVE_AMOUNT FROM Employee AS E
	LEFT JOIN Incentive AS I ON E.EMPLOYEE_ID = I.EMPLOYEE_REF_ID 
	)
SELECT FIRST_NAME , INCENTIVE_AMOUNT FROM EMP_ALL_INC